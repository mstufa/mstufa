<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="google-site-verification" content="114TrNaUleL5DYyWmYYFRbupmCwiUYlmj3LGHK7u8HI" />

    <title>Ø´Ø§Øª ØµÙˆÙÙŠ Ø¹Ù…Ø§Ø±Ù‡</title>

    <meta name="description" content="Ø´Ø§Øª ØµÙˆÙÙŠ Ø¹Ù…Ø§Ø±Ù‡ - Ø¯Ø±Ø¯Ø´Ø© Ø¹Ø±Ø§Ù‚ÙŠØ©ØŒ ØªØ¹Ø§Ø±ÙØŒ Ø´Ø§Øª Ø¨Ù†Ø§ØªØŒ Ø¯Ø®ÙˆÙ„ Ø¨Ø¯ÙˆÙ† ØªØ³Ø¬ÙŠÙ„.">
    <meta name="keywords" content="Ø´Ø§Øª ØµÙˆÙÙŠ, Ø´Ø§Øª Ø¹Ù…Ø§Ø±Ù‡, Ø¯Ø±Ø¯Ø´Ø© Ø¹Ø±Ø§Ù‚ÙŠØ©">
    <meta name="author" content="Mustafa">
    
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; font-family: 'Tajawal', sans-serif; }
        
        body {
            margin: 0; padding: 0; height: 100vh;
            display: flex; justify-content: center; align-items: center;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%);
            overflow: hidden;
        }

        .chat-card {
            width: 100%; max-width: 450px; height: 95vh;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-radius: 25px; 
            border: 2px solid rgba(255, 255, 255, 0.8);
            display: flex; flex-direction: column;
            box-shadow: 0 10px 40px rgba(255, 105, 180, 0.2);
            position: relative; overflow: hidden;
        }

        .rooms-bar {
            padding: 10px; background: rgba(255, 255, 255, 0.8);
            display: flex; gap: 10px; overflow-x: auto;
            border-bottom: 1px solid rgba(255, 182, 193, 0.3);
            scrollbar-width: none;
        }
        .room-btn {
            padding: 8px 16px; border: none; border-radius: 20px;
            background: #fff0f5; color: #ff6b6b;
            font-weight: bold; cursor: pointer; white-space: nowrap;
            transition: 0.3s;
        }
        .room-btn.active {
            background: #ff6b6b; color: white;
            box-shadow: 0 4px 10px rgba(255, 107, 107, 0.4);
        }

        .chat-header {
            padding: 15px; text-align: center;
            background: rgba(255, 255, 255, 0.5);
        }
        .chat-header h2 { margin: 0; color: #d63384; font-size: 20px; }
        .current-room-name { font-size: 12px; color: #666; margin-top: 5px; }

        .chat-body {
            flex: 1; padding: 20px; overflow-y: auto;
            display: flex; flex-direction: column; gap: 15px;
        }

        .message-row { display: flex; align-items: flex-end; gap: 10px; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .msg-container {
            display: flex; flex-direction: column; max-width: 80%;
        }

        .msg-name {
            font-size: 10px; color: #888; margin-bottom: 3px; font-weight: bold; display: flex; justify-content: space-between;
        }

        .delete-btn {
            cursor: pointer; font-size: 12px; margin-right: 5px; opacity: 0.5; transition: 0.2s;
        }
        .delete-btn:hover { opacity: 1; transform: scale(1.2); }

        .msg-content {
            padding: 12px 18px; border-radius: 20px; font-size: 15px;
            line-height: 1.5; position: relative;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05); word-wrap: break-word;
        }

        .mine { flex-direction: row-reverse; }
        .mine .msg-container { align-items: flex-end; }
        .mine .msg-content {
            background: linear-gradient(135deg, #ff758c 0%, #ff7eb3 100%);
            color: white; border-bottom-right-radius: 4px;
        }

        .theirs .msg-container { align-items: flex-start; }
        .theirs .msg-content {
            background: white; color: #555;
            border-bottom-left-radius: 4px;
        }

        .msg-avatar {
            width: 35px; height: 35px; border-radius: 50%;
            background-size: cover; background-position: center;
            background-color: #fff; border: 2px solid white; flex-shrink: 0;
        }

        .chat-footer {
            padding: 15px; background: rgba(255, 255, 255, 0.8);
            display: flex; align-items: center; gap: 10px;
        }
        input {
            flex: 1; padding: 15px; border-radius: 30px; border: 2px solid #ffebf0;
            background: white; color: #333; outline: none;
        }
        .send-btn {
            width: 50px; height: 50px; border-radius: 50%; border: none;
            background: linear-gradient(135deg, #ff758c 0%, #ff7eb3 100%);
            color: white; font-size: 20px; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
        }

        /* Ø§Ù„Ù…ÙˆØ¯Ù„Ø² */
        .modal {
            display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); justify-content: center; align-items: center; z-index: 100;
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background: white; padding: 30px; border-radius: 25px; width: 85%; text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .modal h3 { color: #d63384; margin-bottom: 20px; }
        .modal input { width: 100%; margin: 10px 0 20px; border: 2px solid #ffebf0; }
        
        .welcome-btn {
            background: linear-gradient(135deg, #ff758c 0%, #ff7eb3 100%);
            color: white; padding: 12px 30px; border: none; border-radius: 30px;
            font-size: 16px; cursor: pointer; width: 100%;
        }
    </style>
</head>
<body>

    <div class="chat-card">
        <div class="rooms-bar">
            <button class="room-btn active" onclick="switchRoom('general', this)">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ğŸ </button>
            <button class="room-btn" onclick="switchRoom('friends', this)">ØªØ¹Ø§Ø±Ù ğŸ¤</button>
            <button class="room-btn" onclick="switchRoom('girls', this)">Ø¨Ù†Ø§Øª ÙˆØ¨Ø³ ğŸ€</button>
            <button class="room-btn" onclick="openPrivateModal()">ØºØ±ÙØ© Ø®Ø§ØµØ© ğŸ”’</button>
        </div>

        <div class="chat-header">
            <h2>ğŸ‘‘ Ø´Ø§Øª ØµÙˆÙÙŠ Ø¹Ù…Ø§Ø±Ù‡ ğŸ‘‘</h2>
            <div class="current-room-name" id="roomTitle">Ø§Ù„ØºØ±ÙØ©: Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
        </div>

        <div class="chat-body" id="chatBox"></div>

        <div class="chat-footer">
            <input type="text" id="msgInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..." onkeypress="handleEnter(event)">
            <button class="send-btn" onclick="sendMsg()">â¤</button>
        </div>

        <div class="modal" id="loginModal" style="display: flex;">
            <div class="modal-content">
                <h3>ğŸŒ¸ Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ø´Ø§Øª ğŸŒ¸</h3>
                <p>ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù…Ùƒ Ø§Ù„Ù…Ø³ØªØ¹Ø§Ø±</p>
                <input type="text" id="usernameInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§...">
                <button class="welcome-btn" onclick="saveName()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø´Ø§Øª</button>
            </div>
        </div>

        <div class="modal" id="privateModal">
            <div class="modal-content">
                <h3>ØºØ±ÙØ© Ø®Ø§ØµØ© ğŸ”’</h3>
                <p>Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ØºØ±ÙØ© Ø§Ù„Ø³Ø±ÙŠØ©</p>
                <input type="text" id="privateRoomInput" placeholder="Ø§Ø³Ù… Ø§Ù„ØºØ±ÙØ©">
                <button class="welcome-btn" onclick="joinPrivateRoom()">Ø¯Ø®ÙˆÙ„</button>
                <button class="room-btn" onclick="closeModal()" style="margin-top:10px; background:none; color:#666">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onChildAdded, onChildRemoved, remove, off } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCTIGaJkfT2sM7cOGcKGeD6c-rmpozCD-w",
            authDomain: "mstufa-1f409.firebaseapp.com",
            databaseURL: "https://mstufa-1f409-default-rtdb.firebaseio.com",
            projectId: "mstufa-1f409",
            storageBucket: "mstufa-1f409.firebasestorage.app",
            messagingSenderId: "638217767100",
            appId: "1:638217767100:web:4bec44dafble8c4e37a8b9",
            measurementId: "G-LZPDYT2TZB"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        
        // Ø±Ù…Ø² Ø§Ù„Ù…Ø¯ÙŠØ± (Ø§Ù„Ø­Ø°Ù)
        const ADMIN_CODE = "2025"; 

        let currentRoom = 'general';
        let messagesRef = ref(db, 'rooms/general/messages');
        let myId = localStorage.getItem('chatUserId');
        if (!myId) {
            myId = 'user_' + Math.random().toString(36).substr(2, 9);
            localStorage.setItem('chatUserId', myId);
        }
        let myName = localStorage.getItem('chatUsername');

        if (myName) { document.getElementById('loginModal').style.display = 'none'; }

        window.saveName = function() {
            const nameInput = document.getElementById('usernameInput');
            const name = nameInput.value.trim();
            if (name) {
                myName = name;
                localStorage.setItem('chatUsername', name);
                document.getElementById('loginModal').style.display = 'none';
            } else { alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ!"); }
        }

        window.switchRoom = function(roomName, btnElement) {
            if(btnElement) {
                document.querySelectorAll('.room-btn').forEach(b => b.classList.remove('active'));
                btnElement.classList.add('active');
            }
            document.getElementById('chatBox').innerHTML = '';
            document.getElementById('roomTitle').innerText = 'Ø§Ù„ØºØ±ÙØ©: ' + (roomName === 'general' ? 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©' : roomName);
            
            off(messagesRef);
            messagesRef = ref(db, 'rooms/' + roomName + '/messages');
            listenForMessages();
        }

        function listenForMessages() {
            // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø©
            onChildAdded(messagesRef, (snapshot) => {
                const msg = snapshot.val();
                const msgKey = snapshot.key; // Ù…ÙØªØ§Ø­ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø­Ø°Ù
                const chatBox = document.getElementById("chatBox");
                
                const row = document.createElement("div");
                row.id = msgKey; // Ù†Ø¹Ø·ÙŠ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù‡ÙˆÙŠØ© Ø¹Ø´Ø§Ù† Ù†Ø­Ø°ÙÙ‡Ø§
                const isMine = msg.senderId === myId;
                row.className = isMine ? "message-row mine" : "message-row theirs";

                const avatarUrl = isMine 
                    ? "https://cdn-icons-png.flaticon.com/512/4140/4140047.png"
                    : "https://cdn-icons-png.flaticon.com/512/4140/4140051.png";

                const displayName = msg.username ? msg.username : "Ø²Ø§Ø¦Ø±";

                row.innerHTML = `
                    <div class="msg-container">
                        <div class="msg-name">
                            ${displayName}
                            <span class="delete-btn" onclick="deleteMessage('${msgKey}')">ğŸ—‘ï¸</span>
                        </div>
                        <div class="msg-content">${msg.text}</div>
                    </div>
                    <div class="msg-avatar" style="background-image: url('${avatarUrl}')"></div>
                `;

                chatBox.appendChild(row);
                chatBox.scrollTop = chatBox.scrollHeight;
            });

            // Ø­Ø°Ù Ø±Ø³Ø§Ù„Ø© (ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø§Ø´Ø©)
            onChildRemoved(messagesRef, (snapshot) => {
                const msgElement = document.getElementById(snapshot.key);
                if (msgElement) {
                    msgElement.remove();
                }
            });
        }

        listenForMessages();

        window.sendMsg = function() {
            const input = document.getElementById("msgInput");
            const text = input.value;
            if (text.trim() !== "") {
                push(messagesRef, { 
                    text: text, senderId: myId, username: myName, timestamp: Date.now() 
                });
                input.value = "";
            }
        }
        
        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø­Ø°Ù Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ø¯ÙŠØ±
        window.deleteMessage = function(key) {
            let code = prompt("ğŸ—‘ï¸ Ù„Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø©ØŒ Ø§Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ù…Ø¯ÙŠØ±:");
            if (code === ADMIN_CODE) {
                const msgRefToDelete = ref(db, `rooms/${currentRoom}/messages/${key}`);
                remove(msgRefToDelete)
                    .then(() => alert("ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­ âœ…"))
                    .catch((error) => alert("Ø­Ø¯Ø« Ø®Ø·Ø£: " + error));
            } else if (code !== null) {
                alert("âŒ Ø§Ù„ÙƒÙˆØ¯ Ø®Ø·Ø£! Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø­Ø°Ù.");
            }
        }

        window.handleEnter = function(e) { if(e.key === 'Enter') sendMsg(); }
        window.openPrivateModal = function() { document.getElementById('privateModal').style.display = 'flex'; }
        window.closeModal = function() { document.getElementById('privateModal').style.display = 'none'; }
        
        window.joinPrivateRoom = function() {
            const roomName = document.getElementById('privateRoomInput').value;
            if(roomName) {
                switchRoom('private_' + roomName, null);
                document.getElementById('roomTitle').innerText = 'ØºØ±ÙØ© Ø®Ø§ØµØ©: ' + roomName + ' ğŸ”’';
                closeModal();
            }
        }
    </script>
</body>
</html>
